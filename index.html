<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ZeroStorm: The Living Storybook</title>

<!-- 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ZERO-HARM / ANTI-INVERSION NOTICE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
This interactive storybook is designed for creative, educational, and 
collaborative entertainment purposes.

INTENDED USE: 
- Interactive storytelling with 3D visual effects
- Collaborative item crafting and narrative exploration
- Educational game design and creative writing tool

NON-WEAPONIZATION:
- Do not adapt for manipulation, surveillance, or behavioral exploitation
- Crafting system is for creative narrative play, not real-world chemistry
- All collaboration features respect user privacy and consent

PRIVACY & SAFETY:
- All data stored locally in IndexedDB (user device only)
- No external telemetry or tracking
- Collaborative features require explicit user initiation

LICENSE: Open source patterns adapted from community best practices.
See attributions section at document end.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 1: CORE RESET & 3D STORYBOOK FOUNDATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Base styling with 3D perspective and storybook aesthetics
   HOW TO USE: Automatically applied to all elements
   EXPECTED OUTCOME: Rich, textured visual environment with depth
   EXPAND: Add cloth simulation, particle systems, weather effects
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --paper-light: #f4e8d8;
  --paper-dark: #e8d7bf;
  --ink-dark: #2c1810;
  --ink-medium: #5d4e37;
  --gold-accent: #d4af37;
  --purple-magic: #8b4dff;
  --shadow-deep: rgba(44, 24, 16, 0.6);
  --page-curve: cubic-bezier(0.4, 0.0, 0.2, 1);
}

html {
  height: 100%;
  overflow: hidden;
}

body {
  height: 100%;
  font-family: 'Georgia', 'Palatino', serif;
  background: linear-gradient(135deg, #2c1810 0%, #5d4e37 100%);
  color: var(--ink-dark);
  perspective: 2000px;
  perspective-origin: 50% 50%;
  overflow: hidden;
  position: relative;
}

/* Ambient lighting effect */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 30% 20%, rgba(212, 175, 55, 0.15), transparent 50%),
              radial-gradient(circle at 70% 80%, rgba(139, 77, 255, 0.1), transparent 50%);
  pointer-events: none;
  z-index: 0;
  animation: ambientGlow 8s ease-in-out infinite alternate;
}

@keyframes ambientGlow {
  0% { opacity: 0.6; transform: scale(1); }
  100% { opacity: 1; transform: scale(1.05); }
}

/* Floating dust particles */
body::after {
  content: "";
  position: fixed;
  inset: 0;
  background-image: 
    radial-gradient(circle, rgba(255, 255, 255, 0.2) 1px, transparent 1px),
    radial-gradient(circle, rgba(255, 255, 255, 0.15) 1px, transparent 1px);
  background-size: 50px 50px, 80px 80px;
  background-position: 0 0, 40px 40px;
  opacity: 0.3;
  pointer-events: none;
  z-index: 1;
  animation: dustFloat 60s linear infinite;
}

@keyframes dustFloat {
  0% { transform: translateY(0) translateX(0); }
  100% { transform: translateY(-100px) translateX(50px); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 2: BOOK CONTAINER WITH 3D TRANSFORM
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Main storybook container with realistic book appearance
   HOW TO USE: Holds all page content with 3D transforms
   EXPECTED OUTCOME: Physical book illusion with depth and shadows
   EXPAND: Add book closing animation, spine detail, bookmark ribbon
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#book-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) rotateX(5deg);
  width: min(95vw, 1200px);
  height: min(90vh, 800px);
  transform-style: preserve-3d;
  z-index: 10;
  filter: drop-shadow(0 30px 60px var(--shadow-deep));
}

#book {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  transition: transform 0.5s ease;
}

/* Book cover and pages */
.book-page {
  position: absolute;
  width: 100%;
  height: 100%;
  background: linear-gradient(to right, 
    var(--paper-dark) 0%, 
    var(--paper-light) 5%, 
    var(--paper-light) 95%, 
    var(--paper-dark) 100%);
  border-radius: 8px;
  box-shadow: 
    inset 0 0 30px rgba(0, 0, 0, 0.1),
    0 10px 40px rgba(0, 0, 0, 0.3);
  transform-style: preserve-3d;
  backface-visibility: hidden;
  overflow: hidden;
}

/* Paper texture overlay */
.book-page::before {
  content: "";
  position: absolute;
  inset: 0;
  background-image: 
    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.03) 2px, rgba(0, 0, 0, 0.03) 4px),
    repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0, 0, 0, 0.03) 2px, rgba(0, 0, 0, 0.03) 4px);
  opacity: 0.4;
  pointer-events: none;
}

/* Page binding shadow */
.book-page::after {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 40px;
  background: linear-gradient(to right, rgba(0, 0, 0, 0.2), transparent);
  pointer-events: none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 3: PAGE TURN ANIMATIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Realistic 3D page turning with curl effect
   HOW TO USE: Applied automatically on chapter transitions
   EXPECTED OUTCOME: Smooth, physical page flip animation
   EXPAND: Add page curl on hover, multiple page flips, bookmark
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-left {
  transform: rotateY(0deg);
  transform-origin: right center;
  z-index: 2;
}

.page-right {
  transform: rotateY(-180deg);
  transform-origin: left center;
  z-index: 1;
}

.page-turning {
  animation: pageTurn 1.2s var(--page-curve) forwards;
  z-index: 3;
}

.page-turning-back {
  animation: pageTurnBack 1.2s var(--page-curve) forwards;
  z-index: 3;
}

@keyframes pageTurn {
  0% {
    transform: rotateY(0deg);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  }
  50% {
    transform: rotateY(-90deg);
    box-shadow: -20px 0 50px rgba(0, 0, 0, 0.4);
  }
  100% {
    transform: rotateY(-180deg);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  }
}

@keyframes pageTurnBack {
  0% {
    transform: rotateY(-180deg);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  }
  50% {
    transform: rotateY(-90deg);
    box-shadow: 20px 0 50px rgba(0, 0, 0, 0.4);
  }
  100% {
    transform: rotateY(0deg);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  }
}

/* Page curl on hover */
.book-page:hover {
  box-shadow: 
    inset 0 0 30px rgba(0, 0, 0, 0.1),
    0 15px 50px rgba(0, 0, 0, 0.4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 4: CONTENT LAYOUT WITH STORYBOOK TYPOGRAPHY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Rich typographic styling for immersive reading experience
   HOW TO USE: Applied to all text content automatically
   EXPECTED OUTCOME: Beautiful, readable text with story ambiance
   EXPAND: Add illuminated capitals, margin illustrations, footnotes
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-content {
  position: absolute;
  inset: 60px;
  overflow-y: auto;
  overflow-x: hidden;
  padding-right: 15px;
  z-index: 10;
}

/* Custom scrollbar */
.page-content::-webkit-scrollbar {
  width: 8px;
}

.page-content::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.05);
  border-radius: 4px;
}

.page-content::-webkit-scrollbar-thumb {
  background: var(--gold-accent);
  border-radius: 4px;
}

.page-content::-webkit-scrollbar-thumb:hover {
  background: #c9a82e;
}

/* Story title with decorative elements */
.story-title {
  font-size: clamp(1.8rem, 4vw, 2.8rem);
  font-weight: bold;
  color: var(--ink-dark);
  text-align: center;
  margin-bottom: 30px;
  position: relative;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  letter-spacing: 2px;
}

.story-title::before,
.story-title::after {
  content: "âœ¦";
  color: var(--gold-accent);
  margin: 0 15px;
  font-size: 1.2rem;
}

/* Illuminated first letter */
.story-text::first-letter {
  font-size: 4rem;
  line-height: 0.8;
  float: left;
  margin: 5px 10px 0 0;
  color: var(--purple-magic);
  font-weight: bold;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
}

.story-text {
  font-size: clamp(1rem, 2vw, 1.2rem);
  line-height: 1.8;
  text-align: justify;
  margin-bottom: 30px;
  color: var(--ink-dark);
  hyphens: auto;
}

.story-text p {
  margin-bottom: 15px;
  text-indent: 2em;
}

.story-text p:first-of-type {
  text-indent: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 5: CHOICE CARDS WITH 3D DEPTH
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Interactive choice buttons with physical card appearance
   HOW TO USE: Click to make story decisions
   EXPECTED OUTCOME: Tactile, hover-reactive decision cards
   EXPAND: Add card flip animations, more elaborate decorations
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.choices-container {
  display: grid;
  gap: 20px;
  margin-top: 30px;
}

.choice-card {
  background: linear-gradient(135deg, #ffffff 0%, var(--paper-light) 100%);
  border: 3px solid var(--gold-accent);
  border-radius: 12px;
  padding: 25px;
  cursor: pointer;
  position: relative;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  transform-style: preserve-3d;
  box-shadow: 
    0 5px 15px rgba(0, 0, 0, 0.2),
    inset 0 0 20px rgba(255, 255, 255, 0.5);
}

.choice-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, transparent 0%, rgba(212, 175, 55, 0.1) 100%);
  border-radius: 12px;
  opacity: 0;
  transition: opacity 0.4s;
}

.choice-card:hover {
  transform: translateY(-8px) translateZ(20px) rotateX(2deg);
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.3),
    0 0 30px rgba(212, 175, 55, 0.4),
    inset 0 0 20px rgba(255, 255, 255, 0.6);
  border-color: var(--purple-magic);
}

.choice-card:hover::before {
  opacity: 1;
}

.choice-card:active {
  transform: translateY(-4px) translateZ(10px) scale(0.98);
}

.choice-icon {
  font-size: 2.5rem;
  display: block;
  text-align: center;
  margin-bottom: 15px;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
}

.choice-title {
  font-size: 1.4rem;
  font-weight: bold;
  color: var(--ink-dark);
  margin-bottom: 12px;
  text-align: center;
}

.choice-description {
  font-size: 1rem;
  line-height: 1.6;
  color: var(--ink-medium);
  margin-bottom: 15px;
  text-align: center;
}

.choice-cost {
  display: flex;
  justify-content: center;
  gap: 15px;
  padding-top: 15px;
  border-top: 2px dotted var(--gold-accent);
  font-size: 0.95rem;
  font-weight: bold;
}

.choice-cost span {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 5px 12px;
  background: rgba(212, 175, 55, 0.2);
  border-radius: 20px;
}

.choice-card.locked {
  opacity: 0.6;
  cursor: not-allowed;
  background: linear-gradient(135deg, #cccccc 0%, #999999 100%);
  border-color: #666666;
}

.choice-card.locked:hover {
  transform: none;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.lock-reason {
  color: #cc0000;
  font-weight: bold;
  text-align: center;
  margin-top: 10px;
  font-size: 0.9rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 6: HUD WITH ORNATE STORYBOOK STYLING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Persistent stats display with medieval aesthetic
   HOW TO USE: Always visible, shows currencies and progress
   EXPECTED OUTCOME: Elegant, non-intrusive stat overlay
   EXPAND: Add animated currency counters, sparkle effects
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#hud {
  position: fixed;
  top: 20px;
  right: 20px;
  background: linear-gradient(135deg, rgba(244, 232, 216, 0.95), rgba(232, 215, 191, 0.95));
  border: 4px solid var(--gold-accent);
  border-radius: 15px;
  padding: 20px;
  min-width: 280px;
  z-index: 1000;
  box-shadow: 
    0 10px 40px rgba(0, 0, 0, 0.4),
    inset 0 0 20px rgba(255, 255, 255, 0.3);
  transform-style: preserve-3d;
  transition: transform 0.3s ease;
}

#hud::before {
  content: "";
  position: absolute;
  inset: 8px;
  border: 2px solid rgba(212, 175, 55, 0.5);
  border-radius: 10px;
  pointer-events: none;
}

#hud.collapsed {
  transform: translateX(calc(100% - 60px));
}

.hud-toggle {
  position: absolute;
  left: -40px;
  top: 15px;
  background: linear-gradient(135deg, var(--gold-accent), #c9a82e);
  border: 3px solid var(--ink-dark);
  border-radius: 10px 0 0 10px;
  padding: 12px;
  cursor: pointer;
  font-size: 1.4rem;
  transition: all 0.3s;
  box-shadow: -5px 5px 15px rgba(0, 0, 0, 0.3);
}

.hud-toggle:hover {
  background: linear-gradient(135deg, #e6c445, var(--gold-accent));
  transform: scale(1.1);
}

.hud-section {
  margin-bottom: 15px;
  padding-bottom: 12px;
  border-bottom: 2px dotted var(--gold-accent);
}

.hud-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
}

.hud-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--ink-medium);
  margin-bottom: 5px;
  font-weight: bold;
}

.hud-value {
  font-size: 1.3rem;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 10px;
  color: var(--ink-dark);
}

.currency-icon {
  font-size: 1.5rem;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.stat-bar {
  width: 100%;
  height: 10px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 5px;
  overflow: hidden;
  margin-top: 8px;
  border: 1px solid rgba(0, 0, 0, 0.3);
}

.stat-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--purple-magic), var(--gold-accent));
  transition: width 0.5s ease;
  box-shadow: 0 0 10px rgba(139, 77, 255, 0.6);
}

.hud-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 15px;
}

.hud-btn {
  padding: 10px;
  background: linear-gradient(135deg, var(--purple-magic), #7a3de6);
  border: 2px solid var(--ink-dark);
  border-radius: 8px;
  color: #fff;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.hud-btn:hover {
  background: linear-gradient(135deg, #a366ff, var(--purple-magic));
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(139, 77, 255, 0.4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 7: CRAFTING SYSTEM INTERFACE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Collaborative item crafting with drag-and-drop
   HOW TO USE: Select 2-3 items to combine into new creations
   EXPECTED OUTCOME: Alchemical-style crafting with visual feedback
   EXPAND: Add recipe book, crafting animations, rarity tiers
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(8px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

.modal-overlay.active {
  opacity: 1;
  pointer-events: all;
}

.modal-content {
  background: linear-gradient(135deg, var(--paper-light), var(--paper-dark));
  border: 5px solid var(--gold-accent);
  border-radius: 20px;
  padding: 40px;
  max-width: 900px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
  position: relative;
  box-shadow: 
    0 30px 80px rgba(0, 0, 0, 0.6),
    inset 0 0 40px rgba(255, 255, 255, 0.3);
  transform: scale(0.9) translateY(-20px);
  transition: transform 0.4s ease;
}

.modal-overlay.active .modal-content {
  transform: scale(1) translateY(0);
}

.modal-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: linear-gradient(135deg, #cc0000, #990000);
  border: 3px solid var(--ink-dark);
  border-radius: 50%;
  width: 45px;
  height: 45px;
  color: #fff;
  font-size: 1.8rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.modal-close:hover {
  background: linear-gradient(135deg, #ff0000, #cc0000);
  transform: rotate(90deg) scale(1.1);
}

.modal-title {
  font-size: 2.2rem;
  color: var(--ink-dark);
  text-align: center;
  margin-bottom: 30px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
}

.modal-title::before,
.modal-title::after {
  content: "âœ¦";
  color: var(--gold-accent);
  margin: 0 20px;
}

/* Crafting Area */
.crafting-workspace {
  background: rgba(255, 255, 255, 0.5);
  border: 3px dashed var(--gold-accent);
  border-radius: 15px;
  padding: 30px;
  margin: 30px 0;
  min-height: 200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
}

.crafting-slots {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
  flex-wrap: wrap;
  justify-content: center;
}

.craft-slot {
  width: 120px;
  height: 120px;
  border: 4px solid var(--purple-magic);
  border-radius: 15px;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(139, 77, 255, 0.1));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 
    0 5px 15px rgba(0, 0, 0, 0.2),
    inset 0 0 20px rgba(255, 255, 255, 0.5);
  position: relative;
}

.craft-slot:hover {
  transform: scale(1.05);
  box-shadow: 
    0 8px 25px rgba(139, 77, 255, 0.4),
    inset 0 0 30px rgba(255, 255, 255, 0.7);
}

.craft-slot.filled {
  background: linear-gradient(135deg, rgba(212, 175, 55, 0.3), rgba(139, 77, 255, 0.3));
  border-color: var(--gold-accent);
}

.craft-slot.empty::after {
  content: "+";
  font-size: 4rem;
  color: var(--purple-magic);
  opacity: 0.3;
}

.craft-result {
  padding: 20px;
  background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(139, 77, 255, 0.2));
  border: 4px solid var(--gold-accent);
  border-radius: 15px;
  text-align: center;
  min-height: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.craft-result.success {
  animation: craftSuccess 1s ease;
}

@keyframes craftSuccess {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); box-shadow: 0 0 40px rgba(212, 175, 55, 0.8); }
}

.craft-button {
  margin-top: 20px;
  padding: 15px 40px;
  background: linear-gradient(135deg, var(--gold-accent), #c9a82e);
  border: 3px solid var(--ink-dark);
  border-radius: 12px;
  color: var(--ink-dark);
  font-size: 1.2rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  text-transform: uppercase;
  letter-spacing: 1px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.craft-button:hover:not(:disabled) {
  background: linear-gradient(135deg, #e6c445, var(--gold-accent));
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
}

.craft-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Inventory Grid */
.inventory-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 20px;
  margin-top: 30px;
}

.inventory-item {
  background: linear-gradient(135deg, #ffffff, var(--paper-light));
  border: 3px solid var(--purple-magic);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  position: relative;
}

.inventory-item:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 10px 30px rgba(139, 77, 255, 0.4);
  border-color: var(--gold-accent);
}

.inventory-item.selected {
  background: linear-gradient(135deg, rgba(212, 175, 55, 0.3), rgba(139, 77, 255, 0.3));
  border-color: var(--gold-accent);
  box-shadow: 0 0 30px rgba(212, 175, 55, 0.6);
}

.item-icon {
  font-size: 3.5rem;
  margin-bottom: 12px;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
}

.item-name {
  font-weight: bold;
  margin-bottom: 8px;
  color: var(--ink-dark);
  font-size: 1.1rem;
}

.item-description {
  font-size: 0.9rem;
  color: var(--ink-medium);
  line-height: 1.4;
}

.item-count {
  position: absolute;
  top: -8px;
  right: -8px;
  background: var(--gold-accent);
  color: var(--ink-dark);
  border: 2px solid var(--ink-dark);
  border-radius: 50%;
  width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 0.9rem;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 8: NOTIFICATION SYSTEM WITH STORYBOOK FLAIR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Toast notifications with ornate styling
   HOW TO USE: Automatic on achievements and events
   EXPECTED OUTCOME: Elegant, non-intrusive notifications
   EXPAND: Add notification queue, sound effects, particle effects
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notification {
  position: fixed;
  top: 100px;
  right: -450px;
  background: linear-gradient(135deg, var(--paper-light), var(--paper-dark));
  padding: 25px 30px;
  border: 4px solid var(--gold-accent);
  border-radius: 15px;
  max-width: 400px;
  z-index: 3000;
  box-shadow: 
    0 15px 50px rgba(0, 0, 0, 0.5),
    inset 0 0 30px rgba(255, 255, 255, 0.3);
  animation: slideInNotif 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards,
             slideOutNotif 0.6s 3.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
}

@keyframes slideInNotif {
  to { right: 30px; }
}

@keyframes slideOutNotif {
  to { right: -450px; }
}

.notif-title {
  font-size: 1.4rem;
  font-weight: bold;
  margin-bottom: 10px;
  color: var(--ink-dark);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.notif-body {
  font-size: 1rem;
  color: var(--ink-medium);
  line-height: 1.5;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 9: SPLASH SCREEN WITH MNEMONIC SELECTION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Initial onboarding with constellation selection
   HOW TO USE: Player selects 3 words to seed their journey
   EXPECTED OUTCOME: Unique player identity creation
   EXPAND: Add zodiac influences, tarot cards, cosmic animation
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#splash {
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #1a0f0a 0%, #3d2817 100%);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 4000;
  padding: 40px;
  opacity: 1;
  transition: opacity 0.8s ease;
}

#splash.hidden {
  opacity: 0;
  pointer-events: none;
}

.splash-title {
  font-size: clamp(2.5rem, 6vw, 4.5rem);
  color: var(--gold-accent);
  text-shadow: 
    0 0 20px rgba(212, 175, 55, 0.8),
    0 0 40px rgba(139, 77, 255, 0.6);
  margin-bottom: 15px;
  letter-spacing: 4px;
  animation: titleGlow 3s ease-in-out infinite;
}

@keyframes titleGlow {
  0%, 100% { text-shadow: 0 0 20px rgba(212, 175, 55, 0.8), 0 0 40px rgba(139, 77, 255, 0.6); }
  50% { text-shadow: 0 0 30px rgba(212, 175, 55, 1), 0 0 60px rgba(139, 77, 255, 0.8); }
}

.splash-sub {
  font-size: clamp(1rem, 2.5vw, 1.5rem);
  color: var(--paper-light);
  margin-bottom: 50px;
  text-align: center;
  opacity: 0.9;
}

.mnemonic-setup {
  background: linear-gradient(135deg, rgba(244, 232, 216, 0.95), rgba(232, 215, 191, 0.95));
  border: 5px solid var(--gold-accent);
  border-radius: 20px;
  padding: 40px;
  max-width: 800px;
  width: 100%;
  box-shadow: 
    0 30px 80px rgba(0, 0, 0, 0.6),
    inset 0 0 40px rgba(255, 255, 255, 0.3);
}

.mnemonic-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 15px;
  margin: 30px 0;
}

.mnemonic-word {
  padding: 15px;
  background: linear-gradient(135deg, #ffffff, var(--paper-light));
  border: 3px solid var(--purple-magic);
  border-radius: 10px;
  cursor: pointer;
  text-align: center;
  font-size: 1.1rem;
  font-weight: bold;
  color: var(--ink-dark);
  transition: all 0.3s;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.mnemonic-word:hover:not(.disabled) {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(139, 77, 255, 0.4);
  border-color: var(--gold-accent);
}

.mnemonic-word.selected {
  background: linear-gradient(135deg, var(--gold-accent), #e6c445);
  border-color: var(--ink-dark);
  color: var(--ink-dark);
  box-shadow: 0 0 30px rgba(212, 175, 55, 0.8);
}

.mnemonic-word.disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.selected-display {
  margin-top: 25px;
  padding: 20px;
  background: rgba(139, 77, 255, 0.1);
  border: 3px solid var(--purple-magic);
  border-radius: 12px;
  font-size: 1.3rem;
  text-align: center;
  min-height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--ink-dark);
}

.begin-button {
  margin-top: 30px;
  padding: 18px 50px;
  background: linear-gradient(135deg, var(--gold-accent), #c9a82e);
  border: 4px solid var(--ink-dark);
  border-radius: 15px;
  color: var(--ink-dark);
  font-size: 1.4rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.4s;
  text-transform: uppercase;
  letter-spacing: 2px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.begin-button:hover:not(:disabled) {
  background: linear-gradient(135deg, #e6c445, var(--gold-accent));
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 12px 35px rgba(212, 175, 55, 0.6);
}

.begin-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 10: BREADCRUMBS & NAVIGATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Story path tracking with ornate styling
   HOW TO USE: Automatically updated on chapter transitions
   EXPECTED OUTCOME: Visual journey history
   EXPAND: Add timeline view, chapter replay, path comparison
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.breadcrumbs {
  background: rgba(255, 255, 255, 0.6);
  border: 2px solid var(--gold-accent);
  border-radius: 10px;
  padding: 15px 20px;
  margin-bottom: 25px;
  font-size: 0.9rem;
  color: var(--ink-medium);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.breadcrumb-item {
  display: inline;
  color: var(--purple-magic);
  font-weight: bold;
  cursor: pointer;
  transition: color 0.2s;
}

.breadcrumb-item:hover {
  color: var(--gold-accent);
  text-decoration: underline;
}

.breadcrumb-separator {
  margin: 0 10px;
  color: var(--gold-accent);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 11: RESPONSIVE DESIGN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Mobile and tablet adaptations
   HOW TO USE: Automatic responsive breakpoints
   EXPECTED OUTCOME: Usable on all screen sizes
   EXPAND: Add touch gestures, portrait optimizations
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {
  #book-container {
    width: 100vw;
    height: 100vh;
  }

  .page-content {
    inset: 30px;
    font-size: 0.95rem;
  }

  #hud {
    top: 10px;
    right: 10px;
    min-width: 200px;
    padding: 15px;
  }

  .choice-card {
    padding: 20px;
  }

  .mnemonic-grid {
    grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
  }

  .inventory-grid {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 12: ACCESSIBILITY & PRINT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WHAT: Screen reader support and print optimization
   HOW TO USE: Automatic for assistive technologies
   EXPECTED OUTCOME: WCAG 2.1 Level AA compliance
   EXPAND: Add high contrast mode, dyslexia-friendly font option
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

*:focus-visible {
  outline: 4px solid var(--purple-magic);
  outline-offset: 4px;
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

@media print {
  body, #book-container {
    transform: none;
    perspective: none;
  }

  #hud, .hud-toggle, .modal-overlay, .notification {
    display: none !important;
  }

  .book-page {
    box-shadow: none;
    page-break-inside: avoid;
  }
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SPLASH SCREEN WITH MNEMONIC SELECTION
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="splash">
  <h1 class="splash-title">ZEROSTORM</h1>
  <p class="splash-sub">A Living Storybook of Infinite Possibilities</p>
  
  <div class="mnemonic-setup">
    <h3 style="text-align: center; margin-bottom: 15px; color: var(--ink-dark);">
      âœ¦ Choose Your Mnemonic Constellation âœ¦
    </h3>
    <p style="text-align: center; color: var(--ink-medium); margin-bottom: 20px; line-height: 1.6;">
      Select 3 words that will shape your journey through the storm. 
      These cosmic anchors will influence your path and powers.
    </p>
    
    <div class="mnemonic-grid" id="mnemonic-grid"></div>
    
    <div class="selected-display" id="selected-display">
      Your constellation awaits...
    </div>
    
    <div style="text-align: center;">
      <button class="begin-button" id="begin-btn" onclick="beginJourney()" disabled>
        Begin Your Saga
      </button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HUD (HEADS-UP DISPLAY)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="hud">
  <button class="hud-toggle" onclick="toggleHUD()" aria-label="Toggle HUD">âš¡</button>
  
  <div class="hud-section">
    <div class="hud-label">Storm Shards</div>
    <div class="hud-value">
      <span class="currency-icon">ğŸ’</span>
      <span id="shards-display">0</span>
    </div>
  </div>

  <div class="hud-section">
    <div class="hud-label">Wisdom Points</div>
    <div class="hud-value">
      <span class="currency-icon">ğŸ§ </span>
      <span id="wisdom-display">0</span>
    </div>
  </div>

  <div class="hud-section">
    <div class="hud-label">Fate Tokens</div>
    <div class="hud-value">
      <span class="currency-icon">ğŸ²</span>
      <span id="fate-display">0</span>
    </div>
  </div>

  <div class="hud-section">
    <div class="hud-label">Influence Level</div>
    <div class="hud-value">
      <span id="level-display">1</span>
    </div>
    <div class="stat-bar">
      <div class="stat-fill" id="xp-bar" style="width: 0%"></div>
    </div>
    <div style="font-size: 0.75rem; margin-top: 5px; color: var(--ink-medium);">
      <span id="xp-current">0</span> / <span id="xp-needed">100</span>
    </div>
  </div>

  <div class="hud-buttons">
    <button class="hud-btn" onclick="openInventory()">Inventory</button>
    <button class="hud-btn" onclick="openCrafting()">Crafting</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN BOOK CONTAINER
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="book-container" style="display: none;">
  <div id="book">
    <div class="book-page page-left" id="current-page">
      <div class="page-content" id="page-content">
        <div class="breadcrumbs" id="breadcrumbs"></div>
        
        <h2 class="story-title" id="story-title"></h2>
        
        <div class="story-text" id="story-text"></div>
        
        <div id="story-effects"></div>
        
        <div class="choices-container" id="choices-container"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     INVENTORY MODAL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="inventory-modal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeInventory()" aria-label="Close Inventory">Ã—</button>
    <h2 class="modal-title">Your Inventory</h2>
    <p style="text-align: center; color: var(--ink-medium); margin-bottom: 20px;">
      Items collected throughout your journey
    </p>
    <div class="inventory-grid" id="inventory-grid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CRAFTING MODAL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="crafting-modal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeCrafting()" aria-label="Close Crafting">Ã—</button>
    <h2 class="modal-title">Alchemical Crafting</h2>
    <p style="text-align: center; color: var(--ink-medium); margin-bottom: 20px;">
      Combine items to create powerful artifacts
    </p>
    
    <div class="crafting-workspace">
      <div class="crafting-slots" id="craft-slots"></div>
      
      <button class="craft-button" id="craft-btn" onclick="attemptCraft()" disabled>
        âœ¨ Forge Creation âœ¨
      </button>
      
      <div class="craft-result" id="craft-result"></div>
    </div>
    
    <h3 style="margin-top: 30px; text-align: center; color: var(--ink-dark);">
      Select Items to Combine
    </h3>
    <div class="inventory-grid" id="crafting-inventory"></div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 1: INDEXEDDB & STATE MANAGEMENT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

let db;
const DB_NAME = 'ZeroStormDB';
const DB_VERSION = 1;

let gameState = {
  id: 'main',
  mnemonic: [],
  currencies: {
    shards: 50,
    wisdom: 10,
    fate: 3
  },
  level: 1,
  xp: 0,
  xpNeeded: 100,
  inventory: [],
  currentChapter: 'start',
  pathHistory: [],
  stats: {
    choicesMade: 0,
    itemsCrafted: 0,
    secretsFound: 0
  }
};

function initDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);
    
    request.onerror = () => reject(request.error);
    request.onsuccess = () => {
      db = request.result;
      resolve(db);
    };
    
    request.onupgradeneeded = (event) => {
      const db = event.target.result;
      
      if (!db.objectStoreNames.contains('gameState')) {
        db.createObjectStore('gameState', { keyPath: 'id' });
      }
      if (!db.objectStoreNames.contains('choices')) {
        db.createObjectStore('choices', { keyPath: 'timestamp' });
      }
    };
  });
}

function saveToDB(storeName, data) {
  return new Promise((resolve, reject) => {
    const transaction = db.transaction([storeName], 'readwrite');
    const store = transaction.objectStore(storeName);
    const request = store.put(data);
    
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

function loadFromDB(storeName, key) {
  return new Promise((resolve, reject) => {
    const transaction = db.transaction([storeName], 'readonly');
    const store = transaction.objectStore(storeName);
    const request = store.get(key);
    
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

async function saveGameState() {
  try {
    await saveToDB('gameState', gameState);
    console.log('Game saved');
  } catch (error) {
    console.error('Save failed:', error);
  }
}

async function loadGameState() {
  try {
    const saved = await loadFromDB('gameState', 'main');
    if (saved) {
      gameState = { ...gameState, ...saved };
      updateHUD();
    }
  } catch (error) {
    console.error('Load failed:', error);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 2: MNEMONIC SYSTEM
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const mnemonicWords = [
  'Storm', 'Void', 'Echo', 'Rift', 'Dawn',
  'Shadow', 'Pulse', 'Nexus', 'Flux', 'Ember',
  'Mystic', 'Quantum', 'Phoenix', 'Zenith', 'Prism',
  'Catalyst', 'Harmony', 'Entropy', 'Oracle', 'Cipher'
];

let selectedWords = [];

function initMnemonicGrid() {
  const grid = document.getElementById('mnemonic-grid');
  grid.innerHTML = '';
  
  mnemonicWords.forEach(word => {
    const wordEl = document.createElement('div');
    wordEl.className = 'mnemonic-word';
    wordEl.textContent = word;
    wordEl.onclick = () => toggleWord(word, wordEl);
    grid.appendChild(wordEl);
  });
}

function toggleWord(word, element) {
  if (selectedWords.includes(word)) {
    selectedWords = selectedWords.filter(w => w !== word);
    element.classList.remove('selected');
  } else if (selectedWords.length < 3) {
    selectedWords.push(word);
    element.classList.add('selected');
  } else {
    showNotification('Maximum Reached', 'Select only 3 words. Deselect one first.');
    return;
  }
  
  document.querySelectorAll('.mnemonic-word').forEach(el => {
    if (selectedWords.length >= 3 && !el.classList.contains('selected')) {
      el.classList.add('disabled');
    } else {
      el.classList.remove('disabled');
    }
  });
  
  updateSelectedDisplay();
}

function updateSelectedDisplay() {
  const display = document.getElementById('selected-display');
  const beginBtn = document.getElementById('begin-btn');
  
  if (selectedWords.length === 0) {
    display.textContent = 'Your constellation awaits...';
    beginBtn.disabled = true;
  } else if (selectedWords.length < 3) {
    display.innerHTML = `<span style="color: var(--purple-magic);">${selectedWords.join(' â€¢ ')}</span><br><span style="font-size: 0.9rem; opacity: 0.7;">Select ${3 - selectedWords.length} more...</span>`;
    beginBtn.disabled = true;
  } else {
    display.innerHTML = `<span style="color: var(--gold-accent); font-size: 1.3rem;">âœ¦ ${selectedWords.join(' â€¢ ')} âœ¦</span>`;
    beginBtn.disabled = false;
  }
}

async function beginJourney() {
  if (selectedWords.length !== 3) return;
  
  gameState.mnemonic = [...selectedWords];
  
  const bonuses = calculateMnemonicBonuses(selectedWords);
  gameState.currencies.shards += bonuses.shards;
  gameState.currencies.wisdom += bonuses.wisdom;
  gameState.currencies.fate += bonuses.fate;
  
  // Add starter items
  gameState.inventory.push(
    { id: 'rift_shard', name: 'Rift Shard', icon: 'ğŸ’ ', description: 'A fragment of collapsed possibility', count: 1 },
    { id: 'star_dust', name: 'Star Dust', icon: 'âœ¨', description: 'Cosmic essence from beyond', count: 2 }
  );
  
  await saveGameState();
  updateHUD();
  
  document.getElementById('splash').classList.add('hidden');
  setTimeout(() => {
    document.getElementById('splash').style.display = 'none';
    document.getElementById('book-container').style.display = 'block';
    loadChapter('start');
  }, 800);
  
  showNotification('Journey Begins', `Your constellation [${selectedWords.join(', ')}] grants starting bonuses!`);
}

function calculateMnemonicBonuses(words) {
  const hash = words.join('').split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
  return {
    shards: (hash % 30) + 10,
    wisdom: (hash % 10) + 5,
    fate: (hash % 3) + 2
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 3: CHAPTER DATABASE WITH RICH CONTENT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const chapters = {
  start: {
    title: 'The Awakening',
    text: `A rift tears open the sky above, purple lightning cascading through dimensions. Each bolt carries whispers from worlds that never were, singing in frequencies that resonate with your ${gameState.mnemonic[0] || 'essence'}.

The ground beneath crystallizes into fractal patterns that echo your ${gameState.mnemonic[1] || 'nature'}. Something ancient stirs withinâ€”a power connected to ${gameState.mnemonic[2] || 'mystery'}.

Three paths shimmer before you, each pulsing with cosmic potential. Your choice will ripple through infinite timelines.`,
    
    choices: [
      {
        id: 'scout',
        icon: 'ğŸ”',
        label: 'Scout the Perimeter',
        description: 'Observe the rift from a distance. Knowledge illuminates the path forward.',
        cost: { shards: 5 },
        rewards: { wisdom: 5, xp: 15 },
        requirements: {}
      },
      {
        id: 'charge',
        icon: 'âš”ï¸',
        label: 'Charge the Rift',
        description: 'Leap boldly into the unknown. Fortune favors the courageous.',
        cost: { shards: 10 },
        rewards: { shards: 25, xp: 20 },
        requirements: {}
      },
      {
        id: 'listen',
        icon: 'ğŸ§˜',
        label: 'Attune to the Storm',
        description: 'Stand in stillness. Let the cosmic frequencies speak their truth.',
        cost: {},
        rewards: { wisdom: 8, fate: 1, xp: 18 },
        requirements: {}
      }
    ]
  },
  
  scout: {
    title: 'The Observation',
    text: `You crouch low, extending every sense. The rift pulses like a living heart, each beat sending reality-ripples outward.

Through patient observation, you discern patterns: the storm responds to emotion, to thought, to will itself. A crystalline shard materializes, glowing with captured starlight.

Your wisdom grows as you understand the fundamental nature of this phenomenon.`,
    
    effects: [
      { 
        type: 'item', 
        item: { 
          id: 'prismatic_shard', 
          name: 'Prismatic Shard', 
          icon: 'ğŸ”®', 
          description: 'Contains refracted possibilities from alternate timelines',
          count: 1
        } 
      }
    ],
    
    choices: [
      {
        id: 'claim_shard',
        icon: 'ğŸ’',
        label: 'Claim the Shard',
        description: 'Integrate this power into your being. Transform through synthesis.',
        cost: {},
        rewards: { shards: 20, wisdom: 5, xp: 20 },
        requirements: {}
      },
      {
        id: 'study_deeper',
        icon: 'ğŸ“–',
        label: 'Study Further',
        description: 'Decode the shard\'s properties before claiming it. Understanding precedes power.',
        cost: { wisdom: 3 },
        rewards: { wisdom: 12, xp: 25 },
        requirements: {}
      },
      {
        id: 'share_discovery',
        icon: 'ğŸ¤',
        label: 'Share Discovery',
        description: 'Document your findings for other travelers. Collaboration amplifies knowledge.',
        cost: { fate: 1 },
        rewards: { wisdom: 10, fate: 2, xp: 22 },
        requirements: {}
      }
    ]
  },
  
  charge: {
    title: 'The Leap',
    text: `You sprint toward destiny. Time dilates as you approach the boundaryâ€”each step carrying you across lifetimes, each heartbeat echoing through parallel universes.

The rift's membrane feels like passing through silk woven from lightning. On the other side, gravity becomes negotiable. You float in a realm where ${gameState.mnemonic[0]} and ${gameState.mnemonic[2]} intertwine in impossible geometries.

Bioluminescent entities drift past, acknowledging your courage with wordless respect.`,
    
    effects: [
      {
        type: 'item',
        item: {
          id: 'void_compass',
          name: 'Void Compass',
          icon: 'ğŸ§­',
          description: 'Points toward destinations that don\'t yet exist',
          count: 1
        }
      }
    ],
    
    choices: [
      {
        id: 'explore_void',
        icon: 'ğŸŒŒ',
        label: 'Explore the Void',
        description: 'Venture deeper. Map the topology of impossible space.',
        cost: { shards: 15 },
        rewards: { wisdom: 10, xp: 30 },
        requirements: {}
      },
      {
        id: 'commune_entities',
        icon: 'ğŸ‘ï¸',
        label: 'Commune with Entities',
        description: 'Establish contact with the luminous beings. Exchange knowledge across realities.',
        cost: { wisdom: 5, fate: 1 },
        rewards: { wisdom: 15, fate: 2, xp: 28 },
        requirements: {}
      },
      {
        id: 'anchor_portal',
        icon: 'âš“',
        label: 'Anchor a Portal',
        description: 'Create a stable gateway for others to follow. Pioneer safe passage.',
        cost: { shards: 20, fate: 2 },
        rewards: { shards: 40, wisdom: 8, fate: 3, xp: 35 },
        requirements: {}
      }
    ]
  },
  
  listen: {
    title: 'The Attunement',
    text: `You close your eyes and breathe with the storm's rhythm. Lightning becomes visible sound, thunder transforms into tangible light.

Beneath surface reality, you sense something vastâ€”a mycelial consciousness network spanning dimensions. It whispers secrets in frequencies beyond normal perception.

Your ${gameState.mnemonic[1]} nature resonates with these cosmic harmonics, unlocking dormant understanding.`,
    
    effects: [
      {
        type: 'item',
        item: {
          id: 'resonance_crystal',
          name: 'Resonance Crystal',
          icon: 'ğŸµ',
          description: 'Vibrates in harmony with universal frequencies',
          count: 1
        }
      }
    ],
    
    choices: [
      {
        id: 'follow_network',
        icon: 'ğŸ•¸ï¸',
        label: 'Follow the Network',
        description: 'Descend into the consciousness web. Become one with the connected whole.',
        cost: { wisdom: 5 },
        rewards: { wisdom: 15, xp: 25 },
        requirements: {}
      },
      {
        id: 'amplify_signal',
        icon: 'ğŸ“¡',
        label: 'Amplify the Signal',
        description: 'Broadcast your consciousness across dimensions. Speak to infinite versions of yourself.',
        cost: { fate: 2 },
        rewards: { wisdom: 12, fate: 3, xp: 30 },
        requirements: {}
      },
      {
        id: 'record_frequency',
        icon: 'ğŸ’¿',
        label: 'Record the Frequency',
        description: 'Capture this cosmic song. Create an artifact others can learn from.',
        cost: { shards: 10, wisdom: 3 },
        rewards: { shards: 30, wisdom: 10, xp: 28 },
        requirements: {}
      }
    ]
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 4: CRAFTING SYSTEM WITH RECIPES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const craftingRecipes = {
  'rift_shard+star_dust': {
    result: { id: 'cosmic_beacon', name: 'Cosmic Beacon', icon: 'ğŸŒŸ', description: 'Guides travelers through dimensional storms', count: 1 },
    bonus: { shards: 20, wisdom: 5 }
  },
  'rift_shard+prismatic_shard': {
    result: { id: 'reality_lens', name: 'Reality Lens', icon: 'ğŸ‘“', description: 'Reveals hidden narrative branches', count: 1 },
    bonus: { wisdom: 10, fate: 1 }
  },
  'star_dust+resonance_crystal': {
    result: { id: 'harmony_orb', name: 'Harmony Orb', icon: 'ğŸ”µ', description: 'Balances conflicting energies', count: 1 },
    bonus: { shards: 15, wisdom: 8 }
  },
  'void_compass+resonance_crystal': {
    result: { id: 'navigator_staff', name: 'Navigator\'s Staff', icon: 'ğŸª„', description: 'Charts paths through impossible geometries', count: 1 },
    bonus: { wisdom: 12, fate: 2 }
  },
  'prismatic_shard+resonance_crystal+void_compass': {
    result: { id: 'infinity_key', name: 'Infinity Key', icon: 'ğŸ”‘', description: 'Unlocks doors between all realities', count: 1 },
    bonus: { shards: 50, wisdom: 20, fate: 5 }
  },
  'rift_shard+star_dust+resonance_crystal': {
    result: { id: 'genesis_seed', name: 'Genesis Seed', icon: 'ğŸŒ±', description: 'Contains potential for entire universes', count: 1 },
    bonus: { shards: 40, wisdom: 15, fate: 3 }
  }
};

let selectedCraftItems = [];

function openCrafting() {
  const modal = document.getElementById('crafting-modal');
  const inventory = document.getElementById('crafting-inventory');
  
  selectedCraftItems = [];
  renderCraftingSlots();
  renderCraftingInventory();
  
  document.getElementById('craft-result').innerHTML = '<p style="opacity: 0.6;">Combine 2-3 items to create something new...</p>';
  
  modal.classList.add('active');
}

function closeCrafting() {
  document.getElementById('crafting-modal').classList.remove('active');
  selectedCraftItems = [];
}

function renderCraftingSlots() {
  const container = document.getElementById('craft-slots');
  container.innerHTML = '';
  
  for (let i = 0; i < 3; i++) {
    const slot = document.createElement('div');
    slot.className = 'craft-slot';
    
    if (selectedCraftItems[i]) {
      slot.classList.add('filled');
      slot.innerHTML = selectedCraftItems[i].icon;
      slot.onclick = () => removeCraftItem(i);
    } else {
      slot.classList.add('empty');
    }
    
    container.appendChild(slot);
  }
  
  document.getElementById('craft-btn').disabled = selectedCraftItems.length < 2;
}

function renderCraftingInventory() {
  const container = document.getElementById('crafting-inventory');
  container.innerHTML = '';
  
  if (gameState.inventory.length === 0) {
    container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--ink-medium);">No items available for crafting</p>';
    return;
  }
  
  gameState.inventory.forEach(item => {
    const itemDiv = document.createElement('div');
    itemDiv.className = 'inventory-item';
    
    if (selectedCraftItems.find(i => i.id === item.id)) {
      itemDiv.classList.add('selected');
    }
    
    itemDiv.innerHTML = `
      <div class="item-icon">${item.icon}</div>
      <div class="item-name">${item.name}</div>
      <div class="item-description">${item.description}</div>
      ${item.count > 1 ? `<div class="item-count">${item.count}</div>` : ''}
    `;
    
    itemDiv.onclick = () => selectCraftItem(item);
    container.appendChild(itemDiv);
  });
}

function selectCraftItem(item) {
  if (selectedCraftItems.length >= 3) {
    showNotification('Maximum Items', 'You can only combine 3 items at once.');
    return;
  }
  
  if (selectedCraftItems.find(i => i.id === item.id)) {
    showNotification('Already Selected', 'This item is already in the crafting slot.');
    return;
  }
  
  selectedCraftItems.push(item);
  renderCraftingSlots();
  renderCraftingInventory();
}

function removeCraftItem(index) {
  selectedCraftItems.splice(index, 1);
  renderCraftingSlots();
  renderCraftingInventory();
}

async function attemptCraft() {
  if (selectedCraftItems.length < 2) return;
  
  const recipeKey = selectedCraftItems
    .map(i => i.id)
    .sort()
    .join('+');
  
  const recipe = craftingRecipes[recipeKey];
  
  if (!recipe) {
    document.getElementById('craft-result').innerHTML = `
      <p style="color: #cc0000; font-weight: bold;">âŒ Incompatible Combination</p>
      <p style="font-size: 0.9rem; margin-top: 10px; opacity: 0.8;">These items do not resonate together. Try different combinations.</p>
    `;
    return;
  }
  
  // Remove crafted items from inventory
  selectedCraftItems.forEach(craftItem => {
    const invItem = gameState.inventory.find(i => i.id === craftItem.id);
    if (invItem) {
      invItem.count--;
      if (invItem.count <= 0) {
        gameState.inventory = gameState.inventory.filter(i => i.id !== craftItem.id);
      }
    }
  });
  
  // Add crafted item
  const existing = gameState.inventory.find(i => i.id === recipe.result.id);
  if (existing) {
    existing.count++;
  } else {
    gameState.inventory.push({ ...recipe.result });
  }
  
  // Grant bonuses
  Object.entries(recipe.bonus).forEach(([curr, amt]) => {
    if (curr === 'xp') {
      gainXP(amt);
    } else {
      gameState.currencies[curr] = (gameState.currencies[curr] || 0) + amt;
    }
  });
  
  gameState.stats.itemsCrafted++;
  
  await saveGameState();
  updateHUD();
  
  const resultDiv = document.getElementById('craft-result');
  resultDiv.classList.add('success');
  resultDiv.innerHTML = `
    <div style="font-size: 3rem; margin-bottom: 10px;">${recipe.result.icon}</div>
    <p style="font-size: 1.3rem; font-weight: bold; color: var(--gold-accent); margin-bottom: 10px;">
      âœ¨ ${recipe.result.name} Created! âœ¨
    </p>
    <p style="font-size: 0.95rem; opacity: 0.9;">${recipe.result.description}</p>
  `;
  
  setTimeout(() => {
    resultDiv.classList.remove('success');
  }, 1000);
  
  selectedCraftItems = [];
  renderCraftingSlots();
  renderCraftingInventory();
  
  showNotification('Crafting Success!', `${recipe.result.icon} ${recipe.result.name} has been forged!`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 5: CHAPTER LOADING & PAGE TURNING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function loadChapter(chapterId) {
  const chapter = chapters[chapterId];
  if (!chapter) {
    console.error(`Chapter ${chapterId} not found`);
    return;
  }
  
  // Trigger page turn animation
  const currentPage = document.getElementById('current-page');
  currentPage.classList.add('page-turning');
  
  setTimeout(() => {
    gameState.currentChapter = chapterId;
    gameState.pathHistory.push(chapterId);
    
    // Update content
    document.getElementById('story-title').textContent = chapter.title;
    document.getElementById('story-text').innerHTML = chapter.text
      .split('\n\n')
      .map(p => `<p>${p}</p>`)
      .join('');
    
    // Render effects
    const effectsContainer = document.getElementById('story-effects');
    effectsContainer.innerHTML = '';
    
    if (chapter.effects) {
      chapter.effects.forEach(effect => {
        applyEffect(effect, effectsContainer);
      });
    }
    
    // Render choices
    renderChoices(chapter.choices);
    
    // Update breadcrumbs
    updateBreadcrumbs();
    
    saveGameState();
    
    currentPage.classList.remove('page-turning');
    
    // Scroll to top
    document.getElementById('page-content').scrollTop = 0;
  }, 600);
}

function renderChoices(choices) {
  const container = document.getElementById('choices-container');
  container.innerHTML = '';
  
  choices.forEach((choice, index) => {
    const canAfford = Object.entries(choice.cost || {}).every(([curr, amt]) => 
      gameState.currencies[curr] >= amt
    );
    
    const meetsReqs = !choice.requirements || Object.keys(choice.requirements).length === 0;
    const isLocked = !canAfford || !meetsReqs;
    
    const choiceEl = document.createElement('div');
    choiceEl.className = 'choice-card';
    if (isLocked) choiceEl.classList.add('locked');
    
    let costHTML = '';
    if (choice.cost && Object.keys(choice.cost).length > 0) {
      costHTML = '<div class="choice-cost">';
      for (const [curr, amt] of Object.entries(choice.cost)) {
        const icon = curr === 'shards' ? 'ğŸ’' : curr === 'wisdom' ? 'ğŸ§ ' : 'ğŸ²';
        costHTML += `<span>${icon} ${amt}</span>`;
      }
      costHTML += '</div>';
    }
    
    let lockReason = '';
    if (isLocked && !canAfford) {
      lockReason = '<div class="lock-reason">âš ï¸ Insufficient Resources</div>';
    }
    
    choiceEl.innerHTML = `
      <div class="choice-icon">${choice.icon}</div>
      <div class="choice-title">${choice.label}</div>
      <div class="choice-description">${choice.description}</div>
      ${costHTML}
      ${lockReason}
    `;
    
    if (!isLocked) {
      choiceEl.onclick = () => makeChoice(choice);
    }
    
    choiceEl.style.animationDelay = `${index * 0.1}s`;
    container.appendChild(choiceEl);
  });
}

async function makeChoice(choice) {
  // Deduct costs
  for (const [curr, amt] of Object.entries(choice.cost || {})) {
    gameState.currencies[curr] -= amt;
  }
  
  // Grant rewards
  for (const [reward, amt] of Object.entries(choice.rewards || {})) {
    if (reward === 'xp') {
      gainXP(amt);
    } else {
      gameState.currencies[reward] = (gameState.currencies[reward] || 0) + amt;
    }
  }
  
  gameState.stats.choicesMade++;
  
  await saveToDB('choices', {
    timestamp: Date.now(),
    chapterId: gameState.currentChapter,
    choiceId: choice.id,
    label: choice.label
  });
  
  updateHUD();
  await saveGameState();
  
  if (chapters[choice.id]) {
    loadChapter(choice.id);
  } else {
    showNotification('Chapter Complete', 'More adventures await in future updates!');
  }
}

function applyEffect(effect, container) {
  const effectDiv = document.createElement('div');
  effectDiv.style.cssText = `
    background: rgba(139, 77, 255, 0.1);
    border-left: 4px solid var(--purple-magic);
    padding: 15px;
    margin: 15px 0;
    border-radius: 8px;
    font-style: italic;
  `;
  
  if (effect.type === 'item') {
    const existing = gameState.inventory.find(i => i.id === effect.item.id);
    if (existing) {
      existing.count++;
    } else {
      gameState.inventory.push({ ...effect.item });
    }
    
    effectDiv.innerHTML = `<strong>âœ¦ Item Acquired:</strong> ${effect.item.icon} ${effect.item.name} â€” ${effect.item.description}`;
    showNotification('Item Found!', `${effect.item.icon} ${effect.item.name}`);
  }
  
  if (effectDiv.innerHTML) {
    container.appendChild(effectDiv);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 6: XP & LEVELING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function gainXP(amount) {
  gameState.xp += amount;
  
  while (gameState.xp >= gameState.xpNeeded) {
    gameState.xp -= gameState.xpNeeded;
    gameState.level++;
    gameState.xpNeeded = Math.floor(gameState.xpNeeded * 1.5);
    
    const rewards = {
      shards: gameState.level * 10,
      wisdom: gameState.level * 2,
      fate: Math.floor(gameState.level / 3)
    };
    
    Object.entries(rewards).forEach(([curr, amt]) => {
      gameState.currencies[curr] += amt;
    });
    
    showNotification('LEVEL UP!', `Level ${gameState.level} â€” New powers awakened!`);
  }
  
  updateHUD();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 7: UI MANAGEMENT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function updateHUD() {
  document.getElementById('shards-display').textContent = gameState.currencies.shards;
  document.getElementById('wisdom-display').textContent = gameState.currencies.wisdom;
  document.getElementById('fate-display').textContent = gameState.currencies.fate;
  document.getElementById('level-display').textContent = gameState.level;
  document.getElementById('xp-current').textContent = gameState.xp;
  document.getElementById('xp-needed').textContent = gameState.xpNeeded;
  
  const xpPercent = (gameState.xp / gameState.xpNeeded) * 100;
  document.getElementById('xp-bar').style.width = `${xpPercent}%`;
}

function toggleHUD() {
  document.getElementById('hud').classList.toggle('collapsed');
}

function openInventory() {
  const modal = document.getElementById('inventory-modal');
  const grid = document.getElementById('inventory-grid');
  
  grid.innerHTML = '';
  
  if (gameState.inventory.length === 0) {
    grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--ink-medium);">Your inventory is empty. Explore to discover items!</p>';
  } else {
    gameState.inventory.forEach(item => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'inventory-item';
      itemDiv.innerHTML = `
        <div class="item-icon">${item.icon}</div>
        <div class="item-name">${item.name}</div>
        <div class="item-description">${item.description}</div>
        ${item.count > 1 ? `<div class="item-count">${item.count}</div>` : ''}
      `;
      grid.appendChild(itemDiv);
    });
  }
  
  modal.classList.add('active');
}

function closeInventory() {
  document.getElementById('inventory-modal').classList.remove('active');
}

function showNotification(title, body) {
  const notif = document.createElement('div');
  notif.className = 'notification';
  notif.innerHTML = `
    <div class="notif-title">${title}</div>
    <div class="notif-body">${body}</div>
  `;
  
  document.body.appendChild(notif);
  
  setTimeout(() => {
    notif.remove();
  }, 4000);
}

function updateBreadcrumbs() {
  const container = document.getElementById('breadcrumbs');
  const maxDisplay = 5;
  const path = gameState.pathHistory.slice(-maxDisplay);
  
  const html = path.map((chapterId, idx) => {
    const chapter = chapters[chapterId];
    const isLast = idx === path.length - 1;
    return `
      <span class="breadcrumb-item">${chapter?.title || chapterId}</span>
      ${!isLast ? '<span class="breadcrumb-separator">â†’</span>' : ''}
    `;
  }).join('');
  
  container.innerHTML = `<strong>Your Journey:</strong> ${html}`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION 8: INITIALIZATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function init() {
  try {
    await initDB();
    await loadGameState();
    initMnemonicGrid();
    updateHUD();
    
    if (gameState.mnemonic && gameState.mnemonic.length > 0) {
      document.getElementById('splash').style.display = 'none';
      document.getElementById('book-container').style.display = 'block';
      loadChapter(gameState.currentChapter);
    }
    
    console.log('ZeroStorm initialized');
  } catch (error) {
    console.error('Init error:', error);
    showNotification('Error', 'Failed to initialize. Please refresh.');
  }
}

document.addEventListener('DOMContentLoaded', init);

// Auto-save every 30 seconds
setInterval(() => {
  if (gameState.currentChapter) {
    saveGameState();
  }
}, 30000);

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeInventory();
    closeCrafting();
  }
  
  if (e.key === 's' && e.ctrlKey) {
    e.preventDefault();
    saveGameState();
    showNotification('Saved', 'Progress preserved');
  }
});

</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ATTRIBUTIONS & LICENSES
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     
     3D CSS transforms: Inspired by CSS3 spec examples (W3C)
     Page turn animation: Adapted from David DeSandro's 3D transforms
     Crafting system: Inspired by alchemy systems in traditional RPGs
     IndexedDB patterns: Mozilla Developer Network (CC0)
     
     All code written by Foster + Navi for Planetary Restoration Archive
     License: MIT License
     
     ZERO-HARM COMMITMENT:
     This storybook is for creative play and collaborative storytelling.
     Not for surveillance, manipulation, or extraction.
     All data stays local. No tracking. No telemetry.
     
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<noscript>
  <div style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: var(--ink-dark); color: var(--paper-light); font-family: Georgia, serif; text-align: center; padding: 40px;">
    <div>
      <h1>JavaScript Required</h1>
      <p style="margin-top: 20px; line-height: 1.6;">
        This interactive storybook requires JavaScript to function.<br>
        Please enable JavaScript in your browser settings to begin your journey.
      </p>
    </div>
  </div>
</noscript>

</body>
</html>
